import pandas
import matplotlib.pyplot as plt
import numpy as np
import matplotlib.pyplot as plt
import pandas
import math
from keras.models import Sequential
from keras.layers.core import Dense, Activation, Dropout
from keras.layers import LSTM
from sklearn.preprocessing import MinMaxScaler
from sklearn.metrics import mean_squared_error
from sklearn.metrics import mean_squared_error
from sklearn.model_selection import GridSearchCV
from math import sqrt, log, exp
import statistics

county = 'New York City, New York'

a = [387.4401550292969, 394.0960388183594, 399.8856201171875, 406.4639892578125, 413.0006103515625, 423.53759765625, 430.771240234375, 437.9551696777344, 441.9256286621094, 445.8808898925781, 447.45880126953125, 450.60772705078125, 455.3140869140625, 459.2198486328125, 463.8873596191406, 469.3076477050781, 472.392333984375]


b = [373.9610595703125, 373.9610595703125, 383.71002197265625, 392.5913391113281, 400.6490783691406, 405.9488525390625, 410.5403137207031, 415.73626708984375, 420.87908935546875, 429.1254577636719, 434.7571105957031, 440.3267822265625, 443.3948974609375, 446.445068359375, 447.6598815917969, 450.08087158203125, 453.69158935546875]

'''
New York City, New York
[143450.0, 145646.78125, 148246.3125, 150952.984375, 154352.46875, 158661.5625, 162970.921875, 165880.296875, 167938.125, 169640.53125, 171939.703125, 174355.46875, 176377.09375, 178805.75, 180603.859375, 181802.125, 182911.65625, 184248.890625, 185934.984375, 187349.34375, 188706.0625]

[157890.84375, 159855.953125, 162178.34375, 164593.15625, 167621.625, 171453.703125, 175278.765625, 177857.4375, 179680.28125, 181186.96875, 183219.984375, 185355.34375, 187140.765625, 189284.265625, 190870.390625, 191927.265625, 192904.96875]

#result
-58.66
398.69
1104.91

Cook, Illinois

[22677.181640625, 23430.515625, 24401.615234375, 25612.798828125, 26719.486328125, 28272.966796875, 29493.126953125, 30756.4375, 31888.810546875, 33099.6953125, 34241.3125, 35524.78125, 37188.109375, 38370.59765625, 39934.55078125, 40955.6640625, 42048.453125, 43097.015625, 44262.7265625, 45579.828125, 46565.390625]


[25692.826171875, 26335.068359375, 27152.20703125, 28154.8671875, 29055.55859375, 30296.138671875, 31251.79296875, 32224.6171875, 33082.65234375, 33986.21484375, 34825.26171875, 35754.109375, 36936.05859375, 37761.8671875, 38836.27734375, 39527.18359375, 40257.59765625]

-13.31
429.90
276.86

Fulton, Georgia

[2210.370849609375, 2279.21533203125, 2286.9580078125, 2323.132080078125, 2459.214599609375, 2506.15478515625, 2537.361083984375, 2538.805419921875, 2635.059326171875, 2667.98974609375, 2697.85986328125, 2726.123291015625, 2774.556396484375, 2805.601806640625, 2839.718505859375, 2896.5478515625, 2960.90234375, 3016.55517578125, 3020.9931640625, 3058.22265625, 3100.666259765625]


[2222.641845703125, 2264.56884765625, 2269.253662109375, 2291.058349609375, 2371.9580078125, 2399.47412109375, 2417.666748046875, 2418.506591796875, 2474.114990234375, 2492.97802734375, 2510.0205078125, 2526.08251953125, 2553.4873046875, 2570.9677734375, 2590.106689453125, 2621.8251953125, 2657.5146484375]

0.55
8.77
17.31

King, Washington

[5229.7763671875, 5229.7763671875, 5328.6982421875, 5399.7783203125, 5525.39208984375, 5610.98583984375, 5693.66748046875, 5793.55419921875, 5859.248046875, 5903.94873046875, 5985.01806640625, 6067.22314453125, 6119.95166015625, 6180.314453125, 6256.78125, 6331.31884765625, 6390.0712890625, 6453.96533203125, 6534.40966796875, 6575.6123046875, 6639.486328125]

[5826.09423828125, 5826.09423828125, 5909.904296875, 5969.806640625, 6075.01220703125, 6146.2353515625, 6214.6767578125, 6296.89990234375, 6350.70947265625, 6387.201171875, 6453.12841796875, 6519.673828125, 6562.1787109375, 6610.677734375, 6671.88818359375, 6731.283203125, 6777.91455078125]

-0.95
17.29
26.97

Los Angeles, California

[12997.29296875, 14118.1240234375, 15081.1083984375, 15982.904296875, 16717.876953125, 17378.974609375, 17756.818359375, 18032.1640625, 18566.806640625, 18918.619140625, 19811.318359375, 20241.115234375, 20838.78515625, 21194.921875, 21641.830078125, 21929.90625, 22793.859375, 23228.068359375, 23664.296875, 24074.640625, 24535.681640625]


[13200.525390625, 13942.0048828125, 14561.7841796875, 15129.052734375, 15582.736328125, 15984.5966796875, 16211.7763671875, 16376.220703125, 16692.89453125, 16899.490234375, 17417.5703125, 17663.96875, 18003.5, 18204.130859375, 18454.2109375, 18614.46484375, 19090.517578125]

20.25
-31.39
228.58

New York City, New York Deaths

[15201.0517578125, 15527.65234375, 15795.7373046875, 16043.0, 16258.2275390625, 16281.5654296875, 16955.833984375, 17065.310546875, 17231.572265625, 17349.1484375, 17624.7265625, 17619.853515625, 17848.7421875, 17912.248046875, 18210.03515625, 18299.994140625, 18306.80078125, 18379.525390625, 18684.865234375, 18641.1328125, 18813.61328125]


[16070.3193359375, 16269.970703125, 16432.33984375, 16580.857421875, 16709.220703125, 16723.123046875, 17119.69140625, 17183.32421875, 17279.62890625, 17347.4609375, 17505.517578125, 17502.712890625, 17633.1328125, 17669.158203125, 17837.291015625, 17887.818359375, 17891.640625]

-1.19
54.83
160.18

Cook, Illinois US Deaths

[969.2695922851562, 1001.0062255859375, 1071.844970703125, 1127.1212158203125, 1180.9744873046875, 1239.4197998046875, 1273.886962890625, 1307.1019287109375, 1331.3331298828125, 1407.96728515625, 1448.0184326171875, 1508.4447021484375, 1551.30029296875, 1595.9071044921875, 1622.8919677734375, 1632.85546875, 1706.2763671875, 1755.18408203125, 1816.9808349609375, 1866.5594482421875, 1904.0712890625]

[1098.43798828125, 1122.1241455078125, 1174.068603515625, 1213.777099609375, 1251.82080078125, 1292.4398193359375, 1316.0853271484375, 1338.666259765625, 1355.017578125, 1406.0765380859375, 1432.3878173828125, 1471.626953125, 1499.137451171875, 1527.5030517578125, 1544.537109375, 1550.801513671875, 1596.5872802734375]

1.05
6.18
24.09

Fulton, Georgia Deaths

[80.78585052490234, 84.98895263671875, 86.63787078857422, 89.07784271240234, 91.478759765625, 93.84176635742188, 93.84176635742188, 96.16793823242188, 102.93616485595703, 106.56720733642578, 111.5055923461914, 112.88677215576172, 116.2842788696289, 116.2842788696289, 117.62175750732422, 120.91315460205078, 121.56265258789062, 124.76810455322266, 126.03091430664062, 130.36732482910156, 130.36732482910156]


[91.59083557128906, 95.47026824951172, 96.98412322998047, 99.21629333496094, 101.40380859375, 103.54859924316406, 103.54859924316406, 105.65217590332031, 111.73204803466797, 114.97051239013672, 119.3510513305664, 120.57158660888672, 123.56553649902344, 123.56553649902344, 124.74093627929688, 127.62653350830078, 128.1947479248047]

-0.01
0.23
2.52


King, Washington Deaths

[354.3726806640625, 354.3726806640625, 366.36358642578125, 377.3763122558594, 387.4401550292969, 394.0960388183594, 399.8856201171875, 406.4639892578125, 413.0006103515625, 423.53759765625, 430.771240234375, 437.9551696777344, 441.9256286621094, 445.8808898925781, 447.45880126953125, 450.60772705078125, 455.3140869140625, 459.2198486328125, 463.8873596191406, 469.3076477050781, 472.392333984375]


[373.9610595703125, 373.9610595703125, 383.71002197265625, 392.5913391113281, 400.6490783691406, 405.9488525390625, 410.5403137207031, 415.73626708984375, 420.87908935546875, 429.1254577636719, 434.7571105957031, 440.3267822265625, 443.3948974609375, 446.445068359375, 447.6598815917969, 450.08087158203125, 453.69158935546875]

-0.01
0.37
3.27

Los Angeles Deaths

[697.1255493164062, 715.8162841796875, 758.4801025390625, 823.7090454101562, 883.3939208984375, 930.8648071289062, 970.3695068359375, 988.5621337890625, 1012.5855712890625, 1061.5244140625, 1106.1278076171875, 1150.64794921875, 1200.569580078125, 1227.8270263671875, 1244.790283203125, 1264.676513671875, 1308.407470703125, 1348.3720703125, 1384.0333251953125, 1421.2745361328125, 1453.0157470703125]

[830.2506713867188, 845.9761352539062, 881.3934936523438, 934.3720092773438, 981.7315673828125, 1018.7189331054688, 1049.0775146484375, 1062.935791015625, 1081.1239013671875, 1117.798828125, 1150.812744140625, 1183.3988037109375, 1219.5311279296875, 1239.088623046875, 1251.2015380859375, 1265.3441162109375, 1296.24658203125]

0.69
1.27
19.85

'''



y = []
x = []

for i in range(len(a)):
    y.append(a[i]-b[i])
    x.append(i)

del_y = []
del_x = []

for i in range(len(y)-1):
    del_y.append(y[i+1]-y[i])
    del_x.append(i)

#plt.show()
    

m, c = np.polyfit(del_x, del_y, 1)

y_fit = []

for i in del_x:
    y_fit.append(m*i+c)

plt.ylim(5*min(del_y),5*max(del_y))

plt.xlabel("Date")
plt.ylabel("Rate of COVID-19 Infections")
plt.title(county)
plt.plot(del_x, y_fit,'r')
plt.scatter(del_x, del_y)

dates=['A26','A27','A28','A29','A30','MA1','MA2','MA3','MA4','MA5','MA6','MA7','MA8','MA9','MA10','MA11']
plt.xticks(np.arange(len(dates)), dates, rotation=90)

plt.gca().legend(('best_fit','LSTM_rate'))
plt.savefig(county+"_mitigation.png",bbox_inches='tight')

del_y=np.array(del_y)
y_fit=np.array(y_fit)
print('%.2f'%m)
print('%.2f'%c)
print('%.2f'%np.sqrt(np.mean((del_y - y_fit) ** 2)))
