import pandas
import matplotlib.pyplot as plt
import numpy as np
import matplotlib.pyplot as plt
import pandas
import math
from keras.models import Sequential
from keras.layers.core import Dense, Activation, Dropout
from keras.layers import LSTM
from sklearn.preprocessing import MinMaxScaler
from sklearn.metrics import mean_squared_error
from sklearn.metrics import mean_squared_error
from sklearn.model_selection import GridSearchCV
from math import sqrt, log, exp
import statistics

county = 'New York City, New York'

a = [19664.46875, 19731.0859375, 19782.80859375, 19856.583984375, 19962.65234375, 20025.884765625, 20085.373046875, 20119.86328125, 20170.412109375, 20231.177734375, 20269.185546875, 20326.17578125, 20357.52734375, 20397.677734375, 20432.646484375, 20471.228515625, 20516.33984375, 20541.7734375, 20583.171875, 20610.751953125, 20641.203125, 20669.490234375, 20715.84765625, 20737.572265625, 20761.458984375, 20782.3984375, 20806.275390625]


b = [19649.603515625, 19692.0390625, 19724.951171875, 19771.869140625, 19839.169921875, 19879.208984375, 19916.841796875, 19938.66015625, 19970.59375, 20008.951171875, 20032.896484375, 20068.80859375, 20088.552734375, 20113.78125, 20135.796875, 20160.0078125, 20188.310546875, 20204.27734375, 20230.23046875, 20247.525390625, 20266.59375, 20284.287109375, 20313.2890625]

'''

New York City, New York

[182279.375, 183289.890625, 184698.5625, 185662.46875, 186430.546875, 186922.09375, 187377.9375, 187939.171875, 188803.796875, 189424.40625, 190023.109375, 190678.453125, 191142.546875, 191577.0625, 192084.921875, 192907.90625, 193627.109375, 194196.6875, 194614.03125, 194961.96875, 195424.921875, 195797.65625, 196199.90625, 196601.484375, 197030.1875, 197373.78125, 197661.984375]
1 1 2613.6023969806392 9201.797405356281 34473086.59533608 20121178.0

[188777.515625, 189485.65625, 190469.625, 191139.984375, 191673.375, 192014.21875, 192329.453125, 192717.59375, 193314.0, 193740.890625, 194152.25, 194601.953125, 194919.765625, 195217.046875, 195564.0, 196125.25, 196614.609375, 197001.25, 197284.578125, 197520.46875, 197833.40625, 198085.828125, 198357.28125]
1 5 1353.7617867470317 7781.34166039326 28195514.158790167 7809068.0

#result
5.82
13.98
217.41

Cook, Illinois

[58387.68359375, 60227.0078125, 61514.3125, 62668.27734375, 63551.453125, 64835.7578125, 65703.78125, 67015.4140625, 68160.4140625, 69348.6484375, 70587.5546875, 71922.0078125, 72826.609375, 73424.8984375, 74004.5234375, 74650.3515625, 75436.875, 76132.59375, 76787.3984375, 77248.96875, 78199.0078125, 78625.328125, 79033.09375, 79537.28125, 79999.28125, 80398.90625, 80709.734375]
1 1 281.62694510681405 2265.3871322012888 64046458.274348415 45320456.0

[64335.98046875, 66235.9765625, 67568.28125, 68764.1640625, 69680.59375, 71014.96875, 71918.3046875, 73285.046875, 74480.1796875, 75722.671875, 77020.40625, 78420.6640625, 79371.7109375, 80001.2578125, 80611.96875, 81292.890625, 82123.0859375, 82858.3359375, 83551.3828125, 84039.984375, 85047.171875, 85499.8203125, 85932.75]
1 5 578.6578858291201 1271.966619195165 54701014.427221164 42947196.0

1.75
-220.14
306.69

Fulton, Georgia

[3443.34912109375, 3451.811279296875, 3511.591064453125, 3546.6572265625, 3555.780029296875, 3548.179931640625, 3581.581298828125, 3580.064697265625, 3639.727294921875, 3684.0205078125, 3718.398681640625, 3775.64501953125, 3794.89453125, 3905.11669921875, 3962.616455078125, 4004.5986328125, 4092.97314453125, 4105.1181640625, 4117.24755859375, 4186.14013671875, 4198.16064453125, 4233.42041015625, 4258.71875, 4304.9169921875, 4327.23583984375, 4327.93310546875, 4372.3876953125]
1 1 83.65955870971023 446.27506867468213 181304.8669410151 96652.016

[3768.369384765625, 3775.87548828125, 3828.864013671875, 3859.89990234375, 3867.96826171875, 3861.243896484375, 3890.77880859375, 3889.44287109375, 3942.12890625, 3981.189208984375, 4011.472900390625, 4061.842041015625, 4078.762939453125, 4175.49169921875, 4225.84716796875, 4262.5634765625, 4339.75244140625, 4350.34228515625, 4360.92041015625, 4420.9443359375, 4431.4111328125, 4462.0869140625, 4484.08642578125]
1 5 66.35040713866773 364.6856158046123 138226.80907372403 57458.848

-0.76
12.57
41.55

King, Washington

[7119.48681640625, 7182.3515625, 7210.5009765625, 7291.47998046875, 7328.25830078125, 7362.56689453125, 7402.37890625, 7431.8017578125, 7454.02197265625, 7484.94873046875, 7484.94873046875, 7575.0400390625, 7608.921875, 7616.0009765625, 7638.01416015625, 7685.11865234375, 7705.49365234375, 7739.921875, 7817.16943359375, 7841.296875, 7883.25390625, 7950.6552734375, 7992.38134765625, 8033.25341796875, 8068.6533203125, 8099.3720703125, 8129.29248046875]
1 1 83.64395872618111 331.520866469982 138310.17283950618 85364.445

[6990.3798828125, 7040.69970703125, 7063.20556640625, 7127.912109375, 7157.267578125, 7184.62646484375, 7216.36962890625, 7239.81005859375, 7257.50927734375, 7282.125, 7282.125, 7353.77294921875, 7380.67919921875, 7386.3056640625, 7403.79150390625, 7441.1572265625, 7457.3212890625, 7484.6201171875, 7545.7919921875, 7564.888671875, 7598.07958984375, 7651.357421875, 7684.30517578125]
1 5 184.77355291996417 720.2270267165399 94795.30056710774 37292.625

0.52
-0.64
27.36

Los Angeles, California

[33764.8125, 34505.734375, 35303.96484375, 36201.7734375, 36759.40234375, 37141.2890625, 38090.5078125, 39209.58984375, 40170.921875, 41036.125, 41912.2890625, 42655.96875, 43487.34375, 44983.625, 45731.265625, 46624.359375, 48092.25, 49747.87109375, 50745.43359375, 51544.28125, 52495.29296875, 53311.6171875, 54426.921875, 55492.953125, 56505.2890625, 57625.16015625, 58270.0859375]
1 1 727.8573631287014 5855.772379223593 88138745.02331962 58293550.0

[38949.0, 39685.79296875, 40478.1953125, 41367.6875, 41919.28515625, 42296.73046875, 43233.44140625, 44335.6875, 45280.74609375, 46130.09765625, 46988.92578125, 47717.078125, 48530.23046875, 49991.37890625, 50720.56640625, 51590.703125, 53019.16015625, 54627.9609375, 55596.3046875, 56371.2109375, 57293.13671875, 58084.10546875, 59164.1875]
1 5 698.2441399047159 5341.635819918101 60532064.858223066 39111776.0

-9.20
155.54
361.35

New York City, New York Deaths

[19664.46875, 19731.0859375, 19782.80859375, 19856.583984375, 19962.65234375, 20025.884765625, 20085.373046875, 20119.86328125, 20170.412109375, 20231.177734375, 20269.185546875, 20326.17578125, 20357.52734375, 20397.677734375, 20432.646484375, 20471.228515625, 20516.33984375, 20541.7734375, 20583.171875, 20610.751953125, 20641.203125, 20669.490234375, 20715.84765625, 20737.572265625, 20761.458984375, 20782.3984375, 20806.275390625]
1 1 277.71659896428173 1018.2478691005416 214493.3580246914 114603.81

[19649.603515625, 19692.0390625, 19724.951171875, 19771.869140625, 19839.169921875, 19879.208984375, 19916.841796875, 19938.66015625, 19970.59375, 20008.951171875, 20032.896484375, 20068.80859375, 20088.552734375, 20113.78125, 20135.796875, 20160.0078125, 20188.310546875, 20204.27734375, 20230.23046875, 20247.525390625, 20266.59375, 20284.287109375, 20313.2890625]
1 5 291.6183643229244 1455.0768280425762 180688.27977315686 38548.477

-0.25
10.79
12.67


Cook, Illinois Deaths

[2701.876708984375, 2782.632080078125, 2863.742431640625, 2911.9345703125, 2935.0302734375, 2981.06982421875, 3064.3466796875, 3149.669677734375, 3185.76318359375, 3251.29833984375, 3303.945068359375, 3355.427001953125, 3373.1171875, 3399.583984375, 3488.166748046875, 3543.866943359375, 3588.0205078125, 3616.47314453125, 3649.98779296875, 3663.697265625, 3721.74853515625, 3767.582275390625, 3823.2763671875, 3851.83349609375, 3879.46044921875, 3905.332763671875, 3917.8251953125]
1 1 20.786432039942596 77.54100570306488 173147.08093278462 135509.83

[2997.736083984375, 3079.12158203125, 3160.809814453125, 3209.3271484375, 3232.56591796875, 3278.888916015625, 3362.653076171875, 3448.4345703125, 3484.7177734375, 3550.58056640625, 3603.483642578125, 3655.2109375, 3672.988037109375, 3699.58642578125, 3788.58642578125, 3844.546875, 3888.90869140625, 3917.5, 3951.17578125, 3964.960693359375, 4023.302978515625, 4069.36962890625, 4125.3662109375]
1 5 18.440688603238648 46.059863552972644 137524.73345935726 110468.02

-0.58
-0.48
27.97

Fulton, Georgia Deaths

[151.5097198486328, 157.26116943359375, 161.3180389404297, 162.12437438964844, 162.12437438964844, 166.927734375, 169.30734252929688, 169.30734252929688, 181.7598114013672, 186.3289794921875, 187.08529663085938, 186.3289794921875, 188.59364318847656, 196.04920959472656, 199.7244873046875, 206.97305297851562, 210.54763793945312, 211.25868225097656, 214.79473876953125, 218.99624633789062, 219.69210815429688, 221.08029174804688, 225.21554565429688, 225.21554565429688, 226.5843048095703, 226.5843048095703, 229.3077392578125]
1 1 2.6613615451789223 24.577998602971682 1142.6200274348423 632.50055

[160.08267211914062, 165.12547302246094, 168.66635131835938, 169.36859130859375, 169.36859130859375, 173.5415496826172, 175.60252380371094, 175.60252380371094, 186.32228088378906, 190.2294921875, 190.8750762939453, 190.2294921875, 192.161376953125, 198.49900817871094, 201.61119079589844, 207.72691345214844, 210.73252868652344, 211.32943725585938, 214.29481506347656, 217.80996704101562, 218.3914794921875, 219.55039978027344, 222.99761962890625]
1 5 3.3298059997802527 35.010111791781576 945.5916824196598 387.19382

-0.12
1.42
4.06

King, Washington Deaths

[525.7298583984375, 526.6016235351562, 528.3441772460938, 532.6930541992188, 533.5615844726562, 534.4296875, 539.6296997070312, 540.4950561523438, 543.9515380859375, 546.53955078125, 546.53955078125, 550.8455200195312, 553.4237670898438, 555.1408081054688, 561.1375732421875, 563.7013549804688, 565.40869140625, 567.9667358398438, 567.9667358398438, 569.6698608398438, 570.5208129882812, 573.0715942382812, 573.92138671875, 575.619140625, 575.619140625, 577.3148193359375, 578.16259765625]
1 1 5.32931263949653 2.9552161756750643 404.7517146776406 298.791

[519.443359375, 520.1337280273438, 521.5125122070312, 524.9506225585938, 525.636474609375, 526.3217163085938, 530.424072265625, 531.1056518554688, 533.8275146484375, 535.8636474609375, 535.8636474609375, 539.24755859375, 541.2715454101562, 542.6182861328125, 547.3168334960938, 549.322998046875, 550.657958984375, 552.6570434570312, 552.6570434570312, 553.9871215820312, 554.6512451171875, 556.6414184570312, 557.30419921875]
1 5 8.94673340919751 22.574584983678246 340.8393194706994 155.66293

-0.07
1.01
2.33

Los Angeles, California Deaths

[1597.1685791015625, 1636.294921875, 1668.21826171875, 1698.37353515625, 1719.341796875, 1733.506103515625, 1787.44091796875, 1831.2149658203125, 1862.28271484375, 1888.8187255859375, 1916.59375, 1926.5147705078125, 1933.58837890625, 1954.0233154296875, 1993.185546875, 2020.92236328125, 2057.374755859375, 2088.0615234375, 2103.6533203125, 2119.85888671875, 2161.4189453125, 2188.662109375, 2217.03759765625, 2241.2919921875, 2277.076416015625, 2290.656005859375, 2297.748046875]
1 1 34.35378110471602 298.70407920167935 90476.33196159123 44433.574

[1768.3572998046875, 1804.2554931640625, 1833.47998046875, 1861.0374755859375, 1880.17138671875, 1893.0841064453125, 1942.1697998046875, 1981.910400390625, 2010.0684814453125, 2034.0887451171875, 2059.2001953125, 2068.165283203125, 2074.552978515625, 2093.000244140625, 2128.31396484375, 2153.29443359375, 2186.0888671875, 2213.666259765625, 2227.6689453125, 2242.216064453125, 2279.491455078125, 2303.905517578125, 2329.31640625]
1 5 20.737787192788986 289.07988315156473 65307.86389413988 26976.557

-0.19
2.80
16.96

'''

a = a[4:]

y = []
x = []

for i in range(len(a)):
    y.append(a[i]-b[i])
    x.append(i)

del_y = []
del_x = []

for i in range(len(y)-1):
    del_y.append(y[i+1]-y[i])
    del_x.append(i)

m, c = np.polyfit(del_x, del_y, 1)

y_fit = []

for i in del_x:
    y_fit.append(m*i+c)

plt.ylim(5*min(del_y),5*max(del_y))

plt.xlabel("Date")
plt.ylabel("Rate of COVID-19 Infections")
plt.title(county)
plt.plot(del_x, y_fit,'r')
plt.scatter(del_x, del_y)

dates=['MA20','MA21','MA22','MA23','MA24','MA25','MA26','MA27','MA28','MA29','MA30','MA31','JU1','JU2','JU3','JU4','JU5','JU6','JU7','JU8','JU9','JU10']
plt.xticks(np.arange(len(dates)), dates, rotation=90)

plt.gca().legend(('best_fit','LSTM_rate'))
plt.savefig(county+"_mitigation.png",bbox_inches='tight')

del_y=np.array(del_y)
y_fit=np.array(y_fit)
print('%.2f'%m)
print('%.2f'%c)
print('%.2f'%np.sqrt(np.mean((del_y - y_fit) ** 2)))
